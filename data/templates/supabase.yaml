# slogan : Supabase is a Firebase alternative with a built-in Postgres database, Realtime server, API server, and Studio as the web-based management interface.

services:
  supabase-postgres:
    image: supabase/postgres:latest
    volumes:
      - supabase-postgres-data:/var/lib/postgresql/data
    restart: always
    environment:
      POSTGRES_DB: ${POSTGRES_DB:-supabase}
      POSTGRES_USER: $SERVICE_USER_POSTGRES
      POSTGRES_PASSWORD: $SERVICE_PASSWORD_POSTGRES
  supabase-realtime:
    image: supabase/realtime:latest
    restart: always
    environment:
      DB_URI: postgres://$SERVICE_USER_POSTGRES:$SERVICE_PASSWORD_POSTGRES@supabase-postgres:5432/${POSTGRES_DB:-supabase}
      DB_CHANNEL: realtime
      DB_CHANNELS_TABLE: realtime.channels
      INSTANCE_ID: '1'
      PORT: 4000
      SECRET_KEY: $SERVICE_PASSWORD_64_REALTIME
    depends_on:
      - supabase-postgres
    caproverExtra:
      containerHttpPort: 4000
  supabase-api:
    image: supabase/supabase:latest
    restart: always
    environment:
      POSTGREST_URL: http://supabase-postgres:3000
      REALTIME_URL: ws://supabase-realtime:4000
      PORT: 5000
      JWT_SECRET: $SERVICE_PASSWORD_64_ENCRYPTION
    depends_on:
      - supabase-postgres
      - supabase-realtime
    caproverExtra:
      containerHttpPort: 5000
  supabase-studio:
    image: supabase/studio:latest
    restart: always
    environment:
      DATABASE_URL: postgres://$SERVICE_USER_POSTGRES:$SERVICE_PASSWORD_POSTGRES@supabase-postgres:5432/${POSTGRES_DB:-supabase}
      JWT_SECRET: $SERVICE_PASSWORD_64_ENCRYPTION
      PORT: 80
    depends_on:
      - supabase-postgres
    caproverExtra:
      containerHttpPort: 80
  supabase-kong:
    image: kong:latest
    restart: always
    environment:
      KONG_DATABASE: postgres
      KONG_PG_HOST: supabase-postgres
      KONG_PG_USER: $SERVICE_USER_POSTGRES
      KONG_PG_PASSWORD: $SERVICE_PASSWORD_POSTGRES
      KONG_PG_DATABASE: ${POSTGRES_DB:-supabase}
    depends_on:
      - supabase-postgres
    caproverExtra:
      notExposeAsWebApp: true
  supabase-gotrue:
    image: supabase/gotrue:latest
    restart: always
    environment:
      API_EXTERNAL_URL: http://supabase-gotrue.$$cap_root_domain
      JWT_SECRET: $SERVICE_PASSWORD_64_ENCRYPTION
      DATABASE_URL: postgres://$SERVICE_USER_POSTGRES:$SERVICE_PASSWORD_POSTGRES@supabase-postgres:5432/${POSTGRES_DB:-supabase}
      INSTANCE_ID: '1'
      PORT: 9999
    depends_on:
      - supabase-postgres
    caproverExtra:
      containerHttpPort: 9999
  supabase-postgrest:
    image: postgrest/postgrest:latest
    restart: always
    environment:
      PGRST_DB_URI: postgres://$SERVICE_USER_POSTGRES:$SERVICE_PASSWORD_POSTGRES@supabase-postgres:5432/${POSTGRES_DB:-supabase}
      PGRST_DB_SCHEMA: public
      PGRST_DB_ANON_ROLE: web_anon
      PGRST_DB_CHANNEL_ENABLED: "true"
      PGRST_DB_CHANNEL: realtime
      PGRST_JWT_SECRET: $SERVICE_PASSWORD_64_ENCRYPTION
      PGRST_SERVER_PROXY_URI: http://supabase-postgrest.$$cap_root_domain
      PGRST_SERVER_PORT: 3000
    depends_on:
      - supabase-postgres
    caproverExtra:
      containerHttpPort: 3000
  supabase-storage-api:
    image: supabase/storage-api:latest
    restart: always
    environment:
      STORAGE_API_PUBLIC_URL: https://supabase-storage-api.$$cap_root_domain
      POSTGRES_CONNECTION_STRING: postgres://$SERVICE_USER_POSTGRES:$SERVICE_PASSWORD_POSTGRES@supabase-postgres:5432/${POSTGRES_DB:-supabase}
      PORT: 2101
      JWT_SECRET: $SERVICE_PASSWORD_64_ENCRYPTION
    depends_on:
      - supabase-postgres
    caproverExtra:
      containerHttpPort: 2101
  supabase-imgproxy:
    image: darthsim/imgproxy:latest
    restart: always
    environment:
      IMGPROXY_SECRET_KEY: $SERVICE_PASSWORD_64_SECRET
      IMGPROXY_KEY: $SERVICE_PASSWORD_64_PROXY
    caproverExtra:
      notExposeAsWebApp: true
  supabase-postgres-meta:
    image: supabase/postgres-meta:latest
    restart: always
    environment:
      DATABASE_URL: postgres://$SERVICE_USER_POSTGRES:$SERVICE_PASSWORD_POSTGRES@supabase-postgres:5432/${POSTGRES_DB:-supabase}
      PORT: 3100
    depends_on:
      - supabase-postgres
    caproverExtra:
      containerHttpPort: 3100

